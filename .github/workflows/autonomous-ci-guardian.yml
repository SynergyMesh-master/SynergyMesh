name: ðŸ¤– Autonomous CI Guardian

on:
  pull_request:
    branches: [main, develop]
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  risk-signal:
    name: ðŸ” Predictive failure signal
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5
        with:
          fetch-depth: 0

      - name: Summarize change surface
        id: analyze
        run: |
          set -euo pipefail
          git diff --name-only origin/${{ github.base_ref }}...HEAD > changed_files.txt
          total=$(wc -l < changed_files.txt)
          yaml=$(grep -c '\.ya\?ml$' changed_files.txt || true)
          py=$(grep -c '\.py$' changed_files.txt || true)
          workflows=$(grep -c '^.github/workflows/' changed_files.txt || true)
          echo "total=$total" >> $GITHUB_OUTPUT
          echo "yaml=$yaml" >> $GITHUB_OUTPUT
          echo "python=$py" >> $GITHUB_OUTPUT
          echo "workflows=$workflows" >> $GITHUB_OUTPUT

      - name: Post summary
        run: |
          echo "## CI Guardian" >> "$GITHUB_STEP_SUMMARY"
          echo "- Files changed: ${{ steps.analyze.outputs.total }}" >> "$GITHUB_STEP_SUMMARY"
          echo "- YAML files: ${{ steps.analyze.outputs.yaml }}" >> "$GITHUB_STEP_SUMMARY"
          echo "- Python files: ${{ steps.analyze.outputs.python }}" >> "$GITHUB_STEP_SUMMARY"
          echo "- Workflow files: ${{ steps.analyze.outputs.workflows }}" >> "$GITHUB_STEP_SUMMARY"
